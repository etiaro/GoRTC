<html>
    <head>
        <title>chat example</title>
        <style>
            body{
                width: 100%;
                height: 99%;
                margin: 0;
            }
            .content{
                display: inline-block;
                width: 77vw;
                height: 100%;
            }
            .nav{
                display: inline-block;
                width: 20vw;
                height: 100%;
                vertical-align: top;
                text-align: center;
            }
            a{
                text-decoration: none;
                color: black;
            }
            .user:hover{
                background-color: gray;
            }
            .user{
                color: black;
            }
            .active{
                background-color: blue;
            }
        </style>
    </head>
    <body>
        <div class="nav" >
            <span id="nav"></span>
            <a href="#" id="host"><div class="user">+</div></a>
        </div>
        <div class="content">

        </div>
        <script src="/goRTC"></script>  <!--HERE WE ARE INCLUDING OUR PLUGIN-->
        <script> 
        function init(){
            const rtc = new GoRTC()
            var GORTC = {
                connect:(id)=>{}, 
                host:()=>{}, 
                close: (id)=>{},
                closeAll: ()=>{},
                send: ()=>{label, data}
            }
            var active = ""
            setInterval(()=>{//Some online users listing script
                fetch('/goRTC/list')
                .then(response => response.json())
                .then(data => {
                    var nav = document.getElementById("nav")
                    nav.innerHTML = ""
                    for(const id of data){
                        var el = document.createElement("div")
                        el.className = id===active ? "user active" : "user"
                        el.innerHTML = id
                        el.onclick = ()=>{el.className="user active"; active = id; rtc.connect(id); }
                        var el2 = document.createElement("a"); el2.href = "#"; el2.append(el)
                        nav.append(el2)
                    }
                });
            }, 1000)
            rtc.addEventListener("connected", (e)=>{
                console.log("connected to "+e.detail.id)
                rtc.message(e.detail.id, "msg", "Hi!")
            })
            rtc.addEventListener("failed", (e)=>{
                console.log("failed to connect to "+e.detail.id)
                if(active == e.detail.id)
                    active = ""
            })
            rtc.addEventListener("disconnected", (e)=>{
                console.log("disconnected from "+e.detail.id)
            })
            rtc.addEventListener("closed", (e)=>{
                console.log("closed connection with "+e.detail.id)
            })
            rtc.addEventListener("message", (e)=>{
                console.log(e.detail.id, e.detail.label, e.detail.data)
            })
            //GORTC.addeventlistener("stream", (e)=>{})         e.label, e.data
            //GORTC.addeventlistener("filepart", (e)=>{})       e.label, e.data, e.progress, totalsize, speed
            //GORTC.addeventlistener("file", (e)=>{})           e.label, e.type, e.data
            rtc.addEventListener("hoststarted", (e)=>{
                active = e.detail.id
            })
            //GORTC.addEventListener("hosterror", (e)=>{})      e.error

            document.getElementById("host").onclick = ()=>{rtc.closeAll(); rtc.host()}//handling creation of new 
        }
        document.addEventListener("DOMContentLoaded", init)
        </script>
    </body>
</html>